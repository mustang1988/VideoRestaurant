# VideoRestaurant

---

## VideoRestaurant 是什么?

VideoRestaurant 是一个分布式视频转码服务, 它可以将制定的视频文件重新编码为其他格式, 以便提供给其他服务使用.

## 为什么叫VideoRestaurant?

把一个需要转码的视频文件比作食材, 食客带着食材去到餐厅, 最后享用厨房端出来的菜品.

整个流程就和现实世界中的餐厅一样, 所以叫 VideoRestaurant

## VideoRestaurant的组成部分

正如前面所说的, 食客自己携带食材来到餐厅, 到最终享用到菜品是一个完整的流程, 那么在这样的流程中, 食材依次会接触哪些餐厅的工作人员?

1. 接待员(Waiter)

    接待员会接收食客带来的食材, 询问食客的用餐习惯, 口味偏好等需求

2. 主厨(Chef)

    主厨从接待员那里得到食材和食客的需求, 分析食材的属性, 找到最佳的烹饪方式, 将烹饪步骤进行拆分, 并把对应的工作安排给助手对食材进行料理, 对助手料理完成后对结果进行整合与摆盘设计, 最后出菜.

3. 助手(Assistant)

    接收主厨指派的工作任务, 对食材以指定的方式进行加工.

接待员, 主厨, 助手就是组成VideoRestaurant的主要部分.

## 组件功能与职责介绍

- 接待员(Waiter)

    - 对外提供GRPC服务, 负责接收调用端的请求(拿到食材, 询问口味偏好)
    - 创建转码任务, 放入任务消息队列(向厨房递交食材和口味偏好信息)
    - 读取回调消息队列, 通知调用端转码结果(传菜口取菜并端上桌)

- 主厨(Chef)
  
    - 对内提供WebSocket服务(厨房内部沟通)
    - 从转码任务队列中读取任务消息(拿到食材和口味偏好)
    - 对原始文件进行解析, 根据调用端需求, 设定转码参数(整理食材, 制定菜谱)
    - 对原始文件进行分片(分割烹饪步骤)
    - 通过WebSocket通信分发转码作业到副厨(指派烹饪任务)
    - 所有分片作业完成后, 将分片输出产物进行合成(摆盘)
    - 将作业结果放入回调消息队列(出菜)

- 助手(Assistant)

    - 接收主厨通过WebSocket通信下发的转码作业(拿到菜谱)
    - 执行转码作业(做菜)
    - 上报转码作业结果(报告主厨)